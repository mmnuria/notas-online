# Grupo 1 tardes: 3ti21_g01
### Julen Garcia, Santiago Chiappe, Nuria Manzano, Bianca Popa, Thomas Azevedo, Sonia Palomo y Joan Escutia.

## Primera reunión
1. _Preámbulo:_ 
    - Día 18 de Abril de 2023.
    - 3ti21_g01.
    - Reunión presencial.
    - Miembros:
        - Julen Garcia
        - Santiago Chiappe
        - Bianca Popa
        - Thomas Azevedo
        - Sonia Palomo*
        - Joan Escutia
        - Nuria Manzano (firmante del documeto).

2. _Resumen:_ Presentación y organización del proyecto.

3. _Puntos abordados:_
    - Presentaciones de cada miembro.
        - En este punto se observa que hay varios alumnos que no son españoles, es por ello que se decide comunicarse verbalmente mediante el español o si es necesario el inglés, pero a través de mensajes y demás es totalmente flexible.
    - Reuniones.
        - Se realizan a través de discord, donde se puede comunicar tanto por llamadas telefónicas como por mensajes escritos. Además, por whatssap también se ha creado un grupo en el que la comunicación es frecuente y diaria.
        - Las reuniones son una vez por semana (se amplia en caso necesario).
    - Organización del depósito de materiales.
        - __Google Drive__, tiene las actualizaciones de las anotaciones rápidas de cada acta.
        - __Visual Studio__, se realiza la redacción en formato Markdown de las actas.
        - __GitHub__, el código generado en eclipse se guarda en un repositorio de GitHub donde todos los miembros del grupo tienen acceso.

4. _Nuevas tareas:_
    - Preparación de la actividad "Aspectos esenciales para el trabajo en equipo" para la siguiente reunión con fecha 22 de Abril de 2023.
        - Asignación de la tarea:
            - Agrupación 1 “Comunicación”, Sonia Palomo.
            - Agrupación 1 “Objetivos”, Bianca Popa.
            - Agrupación 1 “Resolución de problemas”, Santiago Chiappe.
            - Agrupación 2 “Brainstorming”, Joan Escutia.
            - Agrupación 2 “Expectativas”, Thomas Azevedo.
            - Agrupación 3 “Conflictos”, Nuria Manzano Mata.
            - Agrupación 3 “Gestión de conflictos”, Julen García.
5. Prototipo: No hay prototipo actual.

6. _Dudas:_
    - No se entiende como se debe de realizar la actividad "Aspectos esenciales para el trabajo en equipo". Se le preguntan en clase directamente al profesor.

__Firmado__ : Nuria Manzano Mata, secretaria.

## Segunda reunión
1. _Preámbulo:_ 
    - Día 22 de Abril de 2023.
    - 3ti21_g01.
    - Reunión mediante la plataforma discord.
    - Miembros:
        - Julen Garcia
        - Santiago Chiappe
        - Bianca Popa
        - Thomas Azevedo
        - Sonia Palomo
        - Joan Escutia
        - Nuria Manzano (firmante del documeto).

2. _Resumen:_ Presentación de la actividad "Aspectos esenciales para el trabajo en equipo".

3. _Puntos abordados:_
    - Presentaciones de cada miembro.
         1. __Sonia Palomo__ hizo el apartado de “Comunicación” de la agrupación 1. En general la presentación fue bien, excepto porque a los dos integrantes del grupo que no son españoles les costaba entender el idioma.
        2. __Joan Escutia__ presentó el apartado “Brainstorming” de la agrupación 2. La opinión del resto de miembros del grupo fue que tenía una buena capacidad de comunicación aunque puesto que Bianca y Thomas no dominan muy bien el español les costaba un poco más seguir el hilo de la presentación.
        3. __Nuria Manzano__ presentó el apartado de la agrupación 3 “Conflictos” los comentarios recibidos por los compañeros fueron positivos, concisos y sin tapujos.
        4. __Bianca Popa__ presentó el apartado “Objetivos” de la agrupación 1 como no habla español lo hizo en inglés y a algunos miembros del grupo que no dominan el inglés les costó entenderla pero entre todos intentamos explicar lo que estaba diciendo.
        5. __Julen Garcia__ se encargó de presentar el último apartado “Gestión de conflictos” perteneciente a la agrupación 3. Su presentación fue bastante correcta aunque tenía algunos problemas a la hora de comunicar en inglés alguna idea a algún compañero extranjero puesto que no domina tanto el idioma.
        6. __Santiago Chiappe__ se preparó “Resolución de problemas” de la agrupación 1. Hizo una excelente presentación y además tradujo la mayoría de cosas al francés para que tanto Bianca como Thomas no tuvieran problemas a la hora de entenderlo.
        7. __Thomas Azevedo__ nos presentó el apartado “Expectativas” de la agrupación 2. Al igual que con Bianca hubo algún problema con la comunicación puesto que al no hablar español había alguna cosa que costaba de entender pero al final conseguimos entendernos gracias a que Santiago habla bastante bien tanto inglés como español.

4. _Nuevas tareas:_
    - Creación proyecto Eclipse y GitHub.
        - Asignación de la tarea: Bianca Popa.
    - Sincronización del proyecto de Eclipse y GitHub.
        - Asignación de la tarea: Para todos (necesario tenerlo sincronizado para comenzar el trabajo).
    - Comenzar la implementación métodos log 0, log 1 y log 2.
        - Asignación de la tarea: Bianca Popa y Santiago Chiappe.

5. Prototipo: No hay prototipo actual.

6. _Dudas:_ No hay dudas.

__Firmado__ : Nuria Manzano Mata, secretaria.

## Tercera reunión
1. _Preámbulo:_ 
    - Día 8 de Mayo de 2023.
    - 3ti21_g01.
    - Reunión presencial.
    - Miembros:
        - Julen Garcia
        - Santiago Chiappe
        - Bianca Popa
        - Thomas Azevedo*
        - Sonia Palomo
        - Joan Escutia
        - Nuria Manzano (firmante del documeto).

2. _Resumen:_ Experimentación básica.

3. _Puntos abordados:_
    - Resolución de problemas con la clonación del repositorio.
    - Activación de GitHub Desktop.
    - Bianca Popa y Santiago Chiappe inicializaron los primeros archivos necesarios para el proyecto, como el contenido en los logs.
    - No hubo demasiado avance dado a los problemas técnicos con la clonación e instalación de GitHub Desktop.

4. _Nuevas tareas:_
    - Resolver los problemas técnicos de la versión de java en Eclipse
        - Asignación de la tarea: Santiago Chiappe.
    - Resolución de los logs necesarios
        - Asignación de la tarea: Bianca Popa.
    - Trabajar con la base de datos y la extracción del contenido a través de comandos curl
        - Asignación de la tarea: Nuria Manzano Mata.

5. Prototipo: Hay prototipo actual, aunque necesita más avance.

6. _Dudas:_ No hay dudas.

__Firmado__ : Nuria Manzano Mata, secretaria.

## Cuarta reunión
1. _Preámbulo:_ 
    - Día 10 de Mayo de 2023.
    - 3ti21_g01.
    - Reunión mediante la plataforma discord.
    - Miembros:
        - Julen Garcia*
        - Santiago Chiappe
        - Bianca Popa
        - Thomas Azevedo*
        - Sonia Palomo
        - Joan Escutia
        - Nuria Manzano (firmante del documeto).

2. _Resumen:_ Detalles para la primera entrega.

3. _Puntos abordados:_
    - Exposicón por parte de Bianca Popa sobre los problemas a tener que resolver con la sincronización de los logs y sus formularios.

4. _Nuevas tareas:_
    - Revisión de los logs realizados.
        - Asignación de la tarea: Nuria Manzano Mata.
    - Resolución de problemas de logs y formularios.
        - Asignación de la tarea: Nuria Manzano Mata.
5. Prototipo: Hay prototipo actual, pero necesita revisión para completarlo.

6. _Dudas:_ De momento no hay dudas. Aunque las dudas oportunas nos las resuelve el profesor en clase.

__Firmado__ : Nuria Manzano Mata, secretaria.

## Quinta reunión
1. _Preámbulo:_ 
    - Día 12, 13 y 14 de Mayo de 2023.
    - 3ti21_g01.
    - Reunión mediante mensajes en Whatssap.
    - Miembros:
        - Julen Garcia
        - Santiago Chiappe
        - Bianca Popa
        - Thomas Azevedo
        - Sonia Palomo
        - Joan Escutia
        - Nuria Manzano (firmante del documeto).

2. _Resumen:_ Últimos detalles para la primera entrega.

3. _Puntos abordados:_
    - log0, log1 y log2 incompletos. Nuria Manzano Mata tuvo que encargarse de su buena implementación, junto con su buena documentación.
        - Creación de una nueva clase java “FileSystem” en la que apoyarse para su buen funcionamiento. 
    - Formularios inexistentes, Nuria Manzano Mata tuvo que encargarse de su buena implementación, junto con su buena documentación.
    - Julen García se encarga del formato Markdown de las actas y Nuria Manzano completa la información requerida en dicho formato relacionada con las órdenes “curl”.
    - Realización por parte de Nuria Manzano Mata del shell script OrdersCE.sh con los comandos “curl” para interactuar con CentroEducativo v0.2

4. _Nuevas tareas:_
    - Revisión de todos los documentos entregados por parte de Nuria Manzano Mata de la entrega del primer hito.
        - Asignación de las tareas: Todos los miembros.
    - Conversación de aclaración de la dinámica del trabajo para las posteriores entregas.
        - Asignación de las tareas: Todos los miembros.

5. Prototipo: Hay prototipo actual.

    - __Actualización:__ Hito 1 completado, incluye:
        - Log0, Log1 y Log2: A continuación muestro parte del código sobre el último __log2__ dado que, es la ampliación de los demás.

        ```java
            public void init(ServletConfig servletConfig) throws ServletException {
                // Initialization code goes here

                // Get log file path from web.xml configuration
                logFilePath = servletConfig.getServletContext().getInitParameter(LOG_FILE_PATH_PARAM);
                Path path = Paths.get(logFilePath);
                String routeDirectory = path.getParent().toString();
                String nameFile = path.getFileName().toString();
                
                // Open log file for writing
                try {
                    if (!fileSystem.exists(routeDirectory)) {
                        fileSystem.createDirectory(routeDirectory);
                    }
                    fileSystem.createFile(routeDirectory, nameFile);
                    logWriter = new PrintWriter(new FileWriter(logFilePath, true));
                } catch (IOException e) {
                    throw new ServletException("Error opening log file", e);
                } catch(Exception e) {
                    throw new ServletException("Error creating directory", e);
                }
            }

            public void doGet(HttpServletRequest request, HttpServletResponse response)
                    throws ServletException, IOException {

                // Get relevant information
                String formData = request.getQueryString();
                String clientInfo = request.getRemoteUser() + " " + request.getRemoteAddr();
                String currentDate = LocalDateTime.now().format(DateTimeFormatter.ISO_LOCAL_DATE_TIME);
                String servletName = request.getServletPath();
                String uri = request.getRequestURI();
                String method = request.getMethod();

                // Log the entry
                String logEntry = currentDate + " " + clientInfo + " " + servletName + " " + method;
                System.out.println(logEntry);
                logWriter.println(logEntry);
                logWriter.flush();
            }
        }
        ```
        El código mostrado se ha usado para implementar el log2, que incluye los anteriores logs, con la diferencia de que en vez de usar una ruta específica de directorio como el log1, hay que configurar la ruta del archivo mediante web.xml.

        En el método init(ServletConfig servletConfig) obtenemos la ruta a través de web.xml y se crea el directorio y el archivo a escribir mediante el método FileSystem().

        ```java
        public class FileSystem {

            public boolean exists(String route) {
                return new File(route).exists();
            }
            
            public void createDirectory(String route) throws Exception {
                if(!new File(route).mkdirs()) {
                    throw new Exception ("unable to create folder");
                }
            }
            public void createFile(String route, String name) throws Exception {
                if(!exists(route)) {
                    throw new Exception ("unable to find folder");
                }
                
                new File(route + "/" + name).createNewFile();
            }

        }
        ```

        Dicho método, nos ofrece métodos para controlar si existe o no el directorio con la ruta específica para crearlo, al igual sucede con el archivo.
        
        Además, log2 funciona gracias a añadir el siguiente código a web.xml

        ```xml
        <context-param>
  	    <param-name>log-file-path</param-name>
        <param-value>/home/user/notas-online/access.log</param-value>
        </context-param>
        ```
        Finalmente, accedemos al formulario siguiente:

        ```html
        <!DOCTYPE html>
        <html lang="en">

        <head>
            <meta charset="UTF-8">
            <title>Notas OnLine - Login</title>
            <!-- Bootstrap CSS -->
            <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/4.0.0/css/bootstrap.min.css">
            <!-- Custom CSS -->
            <link rel="stylesheet" href="../css/style.css">
        </head>

        <body>

            <div class="container">
                <div class="row justify-content-center mt-5">
                    <div class="col-md-6">
                        <div class="card">
                            <div class="card-header">
                                <h4 class="text-center">Notas OnLine</h4>
                            </div>
                            <div class="card-body">
                                <form action="Log2" method="GET">
                                    <div class="form-group text-center">
                                        <button type="submit" class="btn btn-primary btn-block">Log2</button>
                                    </div>
                                </form>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Bootstrap JS -->
            <script src="https://code.jquery.com/jquery-3.2.1.slim.min.js"></script>
            <script src="https://cdnjs.cloudflare.com/ajax/libs/popper.js/1.12.9/umd/popper.min.js"></script>
            <script src="https://maxcdn.bootstrapcdn.com/bootstrap/4.0.0/js/bootstrap.min.js"></script>

            <!-- Login JavaScript -->
            <script src="../js/log.js"></script>

        </body>

        </html>
        ```
        En el cual se puede interactuar con un botón, para observar el correcto funcionamiento (los formularios de los demás logs son similares).

    - Shell Script para los comandos curl y rest:
        ```sh
        #!/bin/bash
        #Iniciar sesión mediante comandos curl con un dni y contraseña (rol no admin)
        echo -e "****** Iniciamos sesion rol NO admin ******\n"
        KEY=$(curl -s --data '{"dni":"23456733H","password":"123456"}' -X POST -H "content-type: application/json" http://localhost:9090/CentroEducativo/login -c cucu -b cucu)

        #Consultamos lista de alumnos
        echo -e "****** Lista de alumnos ******\n"
        curl -s -X GET 'http://localhost:9090/CentroEducativo/alumnos?key='$KEY -H "accept: application/json" -c cucu -b cucu

        #Consultamos lista de alumnos y asignaturas
        echo -e "\n\n****** Lista de alumnos y asignaturas ******\n"
        curl -s -X GET 'http://localhost:9090/CentroEducativo/alumnosyasignaturas?key='$KEY \ - H "accept: application/json" -c cucu -b cucu

        #Consultamos lista de alumnos y calificaciones de DEW
        echo -e "\n\n****** Lista de alumnos y calificaciones de DEW ******\n"
        curl -s -X GET 'http://localhost:9090/CentroEducativo/asignaturas/DEW/alumnos?key='$KEY \ - H "accept: application/json" -c cucu -b cucu

        #Consultamos lista de profesores de la asignatura DEW
        echo -e "\n\n****** Lista de profesores de la asignatura DEW******\n"
        curl -X GET 'http://localhost:9090/CentroEducativo/asignaturas/DEW/profesores?key='$KEY -H "accept: application/json" -c cucu -b cucu

        #Se observa que no contienen notas en dicha asignatura, por ello añadiremos al usuario 12345678W la nota de 9
        #Para ello es necesario iniciar sesion
        #echo -e "\n\n****** Iniciamos sesion del profesor de DEW ******\n"
        #KEY1=$(curl -s --data '{"dni": "23456733H","password":"123456"}' -X POST -H "content-type: application/json" 'http://localhost:9090/CentroEducativo/login' -c cucu -b cucu)
        #KEY2=$(curl -s --data '{"dni":"111111111","password":"654321"}' -X POST -H "content-type: application/json" 'http://localhost:9090/CentroEducativo/login' -c cucu -b cucu)

        #echo -e "\n\n****** Añadimos la nota de un 9 al alumno 12345678W de la asignatura DEW ******\n"
        #curl -X PUT -H "accept: text/plain" -H "Content-Type: application/json" -d "{9}" 'http://localhost:9090/CentroEducativo/alumnos/12345678W/asignaturas?key='$KEY2'/DEW' -c cucu -b cucu -v

        #Para crear un alumno nuevo es necesario ser ROL admin
        echo -e "****** Creamos un nuevo alumno ******\n"
        KEY2=$(curl -s --data '{"dni":"111111111","password":"654321"}' -X POST -H "content-type: application/json" 'http://localhost:9090/CentroEducativo/login' -c cucu -b cucu)

        curl -s --data '{"apellidos": "Nuevo", "dni": "33445566X", "nombre": "Alumno","password": "123456789"}' -X POST -H "content-type: application/json" 'http://localhost:9090/CentroEducativo/alumnos?key='$KEY2 -c cucu -b cucu

        echo -e "\n****** Obtenemos de nuevo los alumnos ******\n"
        curl -s -X GET 'http://localhost:9090/CentroEducativo/alumnos?key='$KEY2 -H "accept: application/json" -c cucu -b cucu

        echo -e "\n\n****** El ultimo alumno de la tabla es el nuevo alumno creado ******\n"

        #Borramos el alumno que acabamos de añadir
        #echo -e "\n\n****** Borramos el alumno que acabamos de añadir ******\n"
        #curl -X DELETE -H "content-type: application/json" -d '{"dni": "33445566X"}' 'http://localhost:9090/CentroEducativo/alumnos?key='$KEY2 -c cucu -b cucu
        #curl -X DELETE 'http://localhost:9090/CentroEducativo/alumnos?key='$KEY2'/33445566X' -H  "Content-Type: application/json" -d '{"dni": "33445566X"}' -c cucu -b cucu -v
        #curl -X DELETE 'http://localhost:9090/CentroEducativo/alumnos/33445566X' -H  "accept: text/plain" -c cucu -b cucu


        #Mostramos alumnos para observar su borrado
        echo -e "\n\n****** Lista de alumnos sin el ultimo añadido ******\n"
        curl -s -X GET 'http://localhost:9090/CentroEducativo/alumnos?key='$KEY2 -H "accept: application/json" -c cucu -b cucu

        #Añadimos una asignatura
        echo -e "\n\n****** Añadimos la asignatura EDA ******\n"
        curl -s --data '{  "acronimo": "EDA",  "creditos": 6,  "cuatrimestre": "Segundo",  "curso": 3,  "nombre": "Estructura de datos"}' -X POST -H "content-type: application/json" 'http://localhost:9090/CentroEducativo/asignaturas?key='$KEY2 -c cucu -b cucu
        #Consultamos las asignaturas
        echo -e "\n\n****** Consultamos las asignaturas y aparecerá EDA ******\n"
        curl -X GET 'http://localhost:9090/CentroEducativo/asignaturas?key='$KEY2 -H  "accept: application/json" -c cucu -b cucu

        #Añadimos un profesor de esa asignatura, como hay que ser administrador usamos la variable KEY2 que guarda la sesion

        echo -e "\n****** Añadimos un profesor (Juan Gonzalez Garcia) ******\n"

        curl -s --data '{"apellidos": "Gonzalez Garcia",  "dni": "209566378V",  "nombre": "Juan",  "password": "987654321"}' -X POST -H "content-type: application/json" 'http://localhost:9090/CentroEducativo/profesores?key='$KEY2 -c cucu -b cucu

        echo -e "\n****** Añadimos ese profesor a la asignatura EDA ******\n"
        curl -X POST 'http://localhost:9090/CentroEducativo/profesores/209566378V/asignaturas?key='$KEY2 -H  "accept: text/plain" -H  "Content-Type: application/json" -d "EDA" -c cucu -b cucu

        echo -e "\n\n****** Mostramos lista de profesores con el nuevo añadido ******\n"
        curl -s -X GET 'http://localhost:9090/CentroEducativo/profesores?key='$KEY2 -H "accept: application/json" -c cucu -b cucu
        echo -e "\n\n****** El ultimo alumno de la tabla es el nuevo profesor creado ******\n"

        echo -e "\n\n****** Mostramos lista de asignaturas que imparte dicho profesor (tiene que impartir EDA) ******\n"
        curl -X GET 'http://localhost:9090/CentroEducativo/profesores/209566378V/asignaturas?key='$KEY2 -H  "accept: application/json" -c cucu -b cucu

        echo -e "\n\n****** Se observa que el profesor añadido imparte (como debe de ser) la asignatura creada EDA  ******\n"

        ```

    Como se observan en los comentarios, dichos comandos sirven para la interacción con la aplicación CentroEducativo.

    - Reporte de fallos, las órdenes DELETE y PUT se han realizado de diversas formas y con diferentes autentificaciones, pero se han obtenido una serie de errores que cuando se corregian salían nuevos.

6. _Dudas:_ No hay dudas después de esta reunión.

__Firmado__ : Nuria Manzano Mata, secretaria.

## Utilización de los Logs.

Para poder utilizar los formularios que interactúan con los servlets log0, log1 y log2, es necesario los siguientes pasos:
  1. Acceder a través de tu máquina virtual a la dirección "http://localhost:8080/notas-online/log[numero_de_log].html".
  2. Accedes a un formulario en el que encontrarás un botón que al hacer click se ejecutará el log correspondiente.
      1. Si ejecutas log0, en la consola del servidor se imprimirá las líneas requeridas (datos del formulario, información del cliente, fecha actual, URI, método).
      2. Si ejecutas log1, realizará lo mismo que el log0 y además en una ruta preestablecida ("/home/user/notas-online/access.log") se guardará en local dicho fichero ("access.log") en donde se escribirá la información del log. En caso de que no exista el directorio "notas-online" y/o el fichero "access.log" se crearán (utilizando la clase FileSystem() de nuestro proyecto).
      3. Si ejecutas log2, realizará lo mismo que log3 pero extrayendo la ruta anterior de la información almacenada en una variable de contexto en web.xml llamada "log-file-path".
  
  ## Información extra para los logs.

  Una vez que ejecutas el servidor Apache Tomcat y __ejecutas el log1 o log2__, teniendo en cuenta que el directorio y el archivo ha sido creado por el usuario en la ruta mencionada anteriormente, para comprobar su correcto funcionamiento. Si se borra dicho directorio, para comprobar si en orden inverso (cuando no existe directorio ni archivo) funciona, es necesario reiniciar el servidor, dado que, aunque se elimine el directorio "notas-online" sigue añadiendo dicha información a alguna parte que no hemos identificado, pero que en principio es inexistente.

  ## Explicación ordenes "curl".

  Se adjunta en la tarea el archivo OrdersCE.sh, un shell script que invoca la orden curl con los argumentos necesarios, pueda ejecutar una secuencia de operaciones sobre la aplicación CentroEducativo.

  El propio script muestra por consola una descripción de lo que está sucediendo. A pesar de ello, lo explicaré a continuación como me lo indica la tarea.

  1.  Iniciamos sesión con un dni y contraseña de un usuario de rol NO admin y guardamos en la variable KEY la clave de sesión generada por el login de este usuario.

      ```sh
      KEY=$(curl -s --data '{"dni":"23456733H","password":"123456"}' -X POST -H "content-type: application/json" http://localhost:9090/CentroEducativo/login -c cucu -b cucu)
      ```

  2. Hacemos una consulta a la lista de alumnos y nos la imprime por consola. Utilizamos la variable KEY donde tenemos almacenada la clave de sesión.

      ```sh
      curl -s -X GET 'http://localhost:9090/CentroEducativo/alumnos?key='$KEY -H "accept: application/json" -c cucu -b cucu
      ```

  3. Hacemos también una consulta a la lista de profesores y nos la imprime por consola. Utilizamos la variable KEY donde tenemos almacenada la clave de sesión.

      ```sh
      curl -s -X GET 'http://localhost:9090/CentroEducativo/profesores?key='$KEY -H "accept: application/json" -c cucu -b cucu
      ```

  4. Añadimos un alumno a la aplicación, pero para ello, hay que iniciar sesión primero con un usuario de rol Admin. Guardamos la clave de sesión en la variable KEY1 de dicho login para poder hacer las operaciones pertinentes.

      ```sh
      KEY1=$(curl -s --data '{"dni":"111111111","password":"654321"}' -X POST -H "content-type: application/json" http://localhost:9090/CentroEducativo/login -c cucu -b cucu)
      ```

  5. Se añade el nuevo alumno con el comando siguiente. Cabe destacar que en la consola aparecerá el mensaje de OK si se realiza correctamente.

      ```sh
      curl -s --data '{"apellidos": "Nuevo", "dni": "33445566X", "nombre": "Alumno","password": "123456789"}' -X POST -H "content-type: application/json" 'http://localhost:9090/CentroEducativo/alumnos?key='$KEY1 -c cucu -b cucu
      ```

  6. Volvemos a mostrar la lista de alumnos, para ver que, efectivamente el último alumno es el que hemos creado. Siendo correcto el funcionamiento.

      ```sh
      curl -s -X GET 'http://localhost:9090/CentroEducativo/alumnos?key='$KEY1 -H "accept: application/json" -c cucu -b cucu
      ```

  7. Ahora vamos a trabajar con las asignaturas, primeramente creamos una asignatura EDA.
  
        ```sh
        curl -s --data '{  "acronimo": "EDA",  "creditos": 6,  "cuatrimestre": "Segundo",  "curso": 3,  "nombre": "Estructura de datos"}' -X POST -H "content-type: application/json" 'http://localhost:9090/CentroEducativo/asignaturas?key='$KEY1 -c cucu -b cucu
        ```
  8. Consultamos las asignaturas para ver como aparece la nueva
        ```sh
        curl -X GET 'http://localhost:9090/CentroEducativo/asignaturas?key='$KEY1 -H  "accept: application/json" -c cucu -b cucu
        ```
  9. Añadimos un profesor a esa asignatura, para ello es necesario añadir primero el profesor, seguidamente lo añadimos a la asignatura y por último mostramos la lista de profesores para observar los cambios.

        ```sh
        curl -s --data '{"apellidos": "Gonzalez Garcia",  "dni": "209566378V",  "nombre": "Juan",  "password": "987654321"}' -X POST -H "content-type: application/json" 'http://localhost:9090/CentroEducativo/profesores?key='$KEY1 -c cucu -b cucu

        echo -e "\n****** Añadimos ese profesor a la asignatura EDA ******\n"

        curl -X POST 'http://localhost:9090/CentroEducativo/profesores/209566378V/asignaturas?key='$KEY1 -H  "accept: text/plain" -H  "Content-Type: application/json" -d "EDA" -c cucu -b cucu

        echo -e "\n\n****** Mostramos lista de profesores con el nuevo añadido ******\n"
        curl -s -X GET 'http://localhost:9090/CentroEducativo/profesores?key='$KEY1 -H "accept: application/json" -c cucu -b cucu
        ```
  10. Para terminar, el comando "-c cucu -b cucu" se añade para crear un archivo .txt que guarda la cookie debido a su requerimiento para, posteriormente usarlo en operaciones de consulta o modificación, ya que, al igual que la clave de sesión, ésta es requerida para la aplicación CentroEducativo.

  ## Experimentación con la herramienta Rested
  ![captura](https://raw.githubusercontent.com/mmnuria/imagesRested/main/Rested1.png)

  ![captura](https://raw.githubusercontent.com/mmnuria/imagesRested/main/Rested2.png)

  ![captura](https://raw.githubusercontent.com/mmnuria/imagesRested/main/Rested3.png)

  ![captura](https://raw.githubusercontent.com/mmnuria/imagesRested/main/Rested4.png)
  Se ve con claridad como en la primera fotografía iniciamos sesión como un usuario de rol alumno, es decir, NO admin, donde nos devuelve la clave de sesión que usaremos para la siguiente captura (Rested2.png). Se observa como obtenemos la lista de asignaturas gracias a la clave de sesión anterior (sin esta clave es imposible la obtención devolviendo un error 415).

  Las capturas 3 y 4, generan otro ejemplo para poder añadir un alumno, que requiere una clave de sesión de un usuario rol ADMIN. Todo ello se contempla con el inicio de sesion del rol admin en Rested3.png, cuya clave de sesión es usada para que se pueda añadir un nuevo alumno, Rested4.png

  ## Sexta reunión
1. _Preámbulo:_ 
    - Día 15 de Mayo de 2023.
    - 3ti21_g01.
    - Reunión presencial en clase.
    - Miembros:
        - Julen Garcia
        - Santiago Chiappe
        - Bianca Popa
        - Thomas Azevedo
        - Sonia Palomo
        - Joan Escutia
        - Nuria Manzano (firmante del documeto).

2. _Resumen:_ Primeras interacciones con CentroEducativo.

3. _Puntos abordados:_
    - Exploración de la API del nivel de datos mediante el plugin RESTED sobre
    Firefox.
    - Cómo interaccionar por programa mediante bibliotecas JSON y REST.
    - Estudio de sesiones en los niveles de lógica y de datos.
    - Adición automatizada mediante curl (asignaturas, profesores y alumnos).
    - Autenticación web.

4. _Nuevas tareas:_
    - Estudiar el caso del log3.
    - Revisar los escenarios de interacción de los dos tipos de usuarios (estudiantes
    y profesores) con la aplicación a desarrollar en la próxima reunión.
    - Revisar roles para el login de nuestra aplicación web.

5. Prototipo: Prototipo sin actualizar.

6. _Dudas:_ No hay dudas después de esta reunión.

__Firmado__ : Nuria Manzano Mata, secretaria.

## Séptima reunión
1. _Preámbulo:_ 
    - Día 17 de Mayo de 2023.
    - 3ti21_g01.
    - Reunión mediante la plataforma de discord.
    - Miembros:
        - Julen Garcia
        - Santiago Chiappe
        - Bianca Popa
        - Thomas Azevedo
        - Sonia Palomo
        - Joan Escutia
        - Nuria Manzano (firmante del documeto).

2. _Resumen:_ Repartición de tareas para el segundo hito.

3. _Puntos abordados:_
    - Explicación de lo que hay que realizar para el segundo hito.

4. _Nuevas tareas:_
    - Desarrollo rol alumno.
        - Asignación de las tareas: Julen García, Joan Escutia, Sonia Palomo y Thomas Azevedo.
    - Desarrollo log3.
        - Asignación de las tareas: Bianca Popa.
    - Desarrollo login con distinciones de rolpro y rolalu.
        - Asignación de las tareas: Bianca Popa, Nuria Manzano y Santiago Chiappe.
    - Trabajar en la mejora del Hito 1.
        - Asignación de las tareas: Nuria Manzano Mata.

5. Prototipo: Prototipo sin actualizar.

6. _Dudas:_ No hay dudas después de esta reunión.

__Firmado__ : Nuria Manzano Mata, secretaria.

## Octava reunión
1. _Preámbulo:_ 
    - Día 22 de Mayo de 2023.
    - 3ti21_g01.
    - Reunión presencial en clase.
    - Miembros:
        - Julen Garcia
        - Santiago Chiappe
        - Bianca Popa
        - Thomas Azevedo
        - Sonia Palomo
        - Joan Escutia
        - Nuria Manzano (firmante del documeto).

2. _Resumen:_ . Secuencias completas con CentroEducativo.

3. _Puntos abordados:_
    - Cada integrante continúa con el desarrollo de su parte del proyecto.

4. _Nuevas tareas:_
    - Para la siguiente reunión tener cada parte completada.
        - Asignación de las tareas: Todos los miembros.

5. Prototipo: Prototipo actualizado.

    - __Actualización:__ Desarrollo del __log3__ completado.

    ```java
    @WebFilter("/*")
    public class AccessLogFilter implements Filter {

        private static final String LOG_FILE_PATH_PARAM = "log-file-path";

        private PrintWriter logWriter;
        private String logFilePath;
        private FileSystem fileSystem = new FileSystem();

        public void init(FilterConfig filterConfig) throws ServletException {
            // Initialization code goes here

            // Get log file path from web.xml configuration
            logFilePath = filterConfig.getServletContext().getInitParameter(LOG_FILE_PATH_PARAM);
            Path path = Paths.get(logFilePath);
            String routeDirectory = path.getParent().toString();
            String nameFile = path.getFileName().toString();

            // Open log file for writing
            try {
                if (!fileSystem.exists(routeDirectory)) {
                    fileSystem.createDirectory(routeDirectory);
                }
                fileSystem.createFile(routeDirectory, nameFile);
                logWriter = new PrintWriter(new FileWriter(logFilePath, true));
            } catch (IOException e) {
                throw new ServletException("Error opening log file", e);
            } catch (Exception e) {
                throw new ServletException("Error creating directory", e);
            }
        }

        public void doFilter(ServletRequest request, ServletResponse response, FilterChain chain)
                throws IOException, ServletException {

            HttpServletRequest httpRequest = (HttpServletRequest) request;

            // Get relevant information
            // String formData = httpRequest.getQueryString();
            String clientInfo = httpRequest.getRemoteUser() + " " + httpRequest.getRemoteAddr();
            String currentDate = LocalDateTime.now().format(DateTimeFormatter.ISO_LOCAL_DATE_TIME);
            String pathInfo = httpRequest.getRequestURI().substring(httpRequest.getContextPath().length());
            // String uri = httpRequest.getRequestURI();
            String method = httpRequest.getMethod();

            // Log the entry
            String logEntry = currentDate + " " + clientInfo + " " + pathInfo + " " + method;
            System.out.println(logEntry);
            if (logWriter != null) {
                logWriter.println(logEntry);
                logWriter.flush();
            }

            chain.doFilter(request, response);
        }

        public void destroy() {
            // Cleanup code goes here

            // Close log file
            if (logWriter != null) {
                logWriter.close();
            }
        }
    }
    ```
    Conversión del servlet logs para que actúe como filtro, activándose al acceder a cualquier página o servlet de la aplicación.

6. _Dudas:_ Las dudas que se generan, se resuelven en clase.

__Firmado__ : Nuria Manzano Mata, secretaria.

## Novena reunión
1. _Preámbulo:_ 
    - Día 25 de Mayo de 2023.
    - 3ti21_g01.
    - Reunión mediante la plataforma de discord.
    - Miembros:
        - Julen Garcia
        - Santiago Chiappe
        - Bianca Popa
        - Thomas Azevedo
        - Sonia Palomo
        - Joan Escutia*
        - Nuria Manzano (firmante del documeto).

2. _Resumen:_ Exposición del trabajo realizado.

3. _Puntos abordados:_
    - Bianca Popa muestra el correcto funcionamiento del login y Santiago Chiappe explica lo necesario para su entendimiento.
    - Julen García muestra el código implementado y comenta las dudas que tiene sobre cómo asociar la página alumno cuando se inicia sesión e integrarlo con el login.
    - Nuria Manzano informa sobre lo necesario para la entrega, para la mejora de las implementaciones, como el requerimiento de la documentación del código.

4. _Nuevas tareas:_
    - Comenzar con el caso del profesor.
        - Asignación de tareas: Bianca Popa.
    - Terminar con el caso de alumno.
        - Asignación de tareas: Julen García, Joan Escutia, Sonia Palomo y Thomas Azevedo.
    - Acta, documentación y organización de la entrega.
        - Asignación de tareas: Nuria Manzano Mata.

5. Prototipo: Prototipo actualizado.

    - __Actualización:__ Implementación de __login__ completada.

    En un principio, el usuario inicia una solicitud para una página específica (/algunaPagina). La solicitud es interceptada por el Filtro de Autenticación (AuthFilter).

    ```java
    @WebFilter("/*")
    public class AuthenticationFilter implements Filter {

        public void doFilter(ServletRequest request, ServletResponse response, FilterChain chain)
                throws IOException, ServletException {
            HttpServletRequest httpRequest = (HttpServletRequest) request;
            HttpServletResponse httpResponse = (HttpServletResponse) response;
            HttpSession session = httpRequest.getSession();

            boolean isLoggedIn = (session != null && session.getAttribute("dni") != null);
            boolean isKeySet = (session.getAttribute("key") != null);

            if (!isLoggedIn && !isKeySet) {
                String login = httpRequest.getRemoteUser();

                if (login != null) {
                    session.setAttribute("dni", login);
                    session.setAttribute("password", "123456");

                    try {
                        // Prepare the request parameters
                        String url = DatabaseConfig.CENTRO_EDUCATIVO_URL + "/login";
                        String payload = "{ \"dni\": \"" + session.getAttribute("dni") + "\", \"password\": \""
                                + session.getAttribute("password") + "\"}";

                        // Make the curl request
                        URL urlObj = new URL(url);
                        HttpURLConnection connection = (HttpURLConnection) urlObj.openConnection();
                        connection.setRequestMethod("POST");
                        connection.setRequestProperty("Accept", "text/plain");
                        connection.setRequestProperty("Content-Type", "application/json");
                        connection.setDoOutput(true);

                        // Write the request payload
                        DataOutputStream outputStream = new DataOutputStream(connection.getOutputStream());
                        outputStream.writeBytes(payload);
                        outputStream.flush();
                        outputStream.close();

                        // Get the response status code
                        int statusCode = connection.getResponseCode();

                        // Read the response
                        if (statusCode == HttpServletResponse.SC_OK) {
                            BufferedReader reader = new BufferedReader(new InputStreamReader(connection.getInputStream()));
                            String line;
                            StringBuilder responseContent = new StringBuilder();
                            while ((line = reader.readLine()) != null) {
                                responseContent.append(line);
                            }
                            reader.close();

                            // Set key as session attribute
                            String key = responseContent.toString();
                            session.setAttribute("key", key);
                            
                            String cookieString = connection.getHeaderFields().get("Set-Cookie").get(0);
                            session.setAttribute("cookie", cookieString);
                            
                            String[] cookieParams = SetCookie(cookieString);
                            Cookie cookie = new Cookie("JSESSIONID", cookieParams[0]);
                            cookie.setPath(cookieParams[1]);
                            // Set max age of cookie to 30 mins
                            cookie.setMaxAge(30 * 60);
                            httpResponse.addCookie(cookie);
                            
                            connection.disconnect();
                        } else {
                            httpResponse.sendError(HttpServletResponse.SC_UNAUTHORIZED, "Data authentication failed");
                        }
                        httpResponse.setStatus(statusCode);
                    } catch (Exception e) {
                        e.printStackTrace();
                        httpResponse.sendError(HttpServletResponse.SC_INTERNAL_SERVER_ERROR,
                                "Error establishing connection to database");
                    }
                } else {
                    httpResponse.sendError(HttpServletResponse.SC_UNAUTHORIZED, "Basic authentication failed");
                }
            }

            // continues the filter chain
            // allows the request to reach the destination
            chain.doFilter(request, response);
        }
        
        String[] SetCookie(String cookie) 
        {
            String cookieSubs = cookie.substring(cookie.indexOf("=") + 1);
            String[] cookieSplited = cookieSubs.split("\\s+");
            
            String cookieValue = cookieSplited[0].substring(0, cookieSplited[0].indexOf(";"));
            
            String cookiePath = cookieSplited[1].substring(cookieSplited[1].indexOf("=") + 1);
            cookiePath = cookiePath.substring(0, cookiePath.indexOf(";"));
            
            cookieSplited[0] = cookieValue;
            cookieSplited[1] = cookiePath;
            
            return cookieSplited;
        }
    }
    ```
    AuthFilter examina la solicitud y verifica si el usuario ya ha iniciado sesión y si la clave de sesión está configurada, para poder enviar el inicio de sesión a la base de datos CentroEducativo y que éste responda con la clave de sesión y la información de la cookie. Para más información, consultar el documento "documentación.md".

6. _Dudas:_ Las dudas han sido resueltas entre nosotros y además, el profesor envió un correo informativo que nos ayudó.

__Firmado__ : Nuria Manzano Mata, secretaria.

## Selección de bibliotecas para nuestro proyecto:

Las librerias usadas en general para todos nuestros archivos, son las básicas necesarias para la implementación de servlet en java, como por ejemplo:

```java
import java.io.IOException;

import javax.servlet.RequestDispatcher;
import javax.servlet.ServletException;
import javax.servlet.annotation.WebServlet;
import javax.servlet.http.HttpServlet;
import javax.servlet.http.HttpServletRequest;
import javax.servlet.http.HttpServletResponse;
```
Entre otras específicas de sesión como "import javax.servlet.http.HttpSession" o "import config.DatabaseConfig" para el control de las llamadas a la API CentroEducativo.

## Identificación del servidor usado:

Cada miembro que ha trabajado en el proyecto puede usar su máquina virtual y clonar el repositorio de GitHub donde guardamos todos los cambios generados.

La máquina virtual que puede utilizar para comprobar el correcto funcionamiento de nuestra web es: dew-nmanmat-2223.dsicv.upv.es 

En esta máquina virtual puedes acceder al servidor tomcat (como en cualquier otra máquina virtual) y para arrancar la API se haría desde el escritorio del usuario. 

## Detalles de la prueba realizada para el escenario de consulta: login, clave, capturas:

1. Accedemos a la url "http://dew-nmanmat-2223.dsicv.upv.es:8080/notas-online/" donde nos aparece la siguiente verificación:

    ![captura](https://raw.githubusercontent.com/mmnuria/imagesRested/main/inicio.png)

2. Iniciamos sesión con rol alumno para observar lo que sucede:

    ![captura](https://raw.githubusercontent.com/mmnuria/imagesRested/main/welcome.png)

    Nos muestra la página de inicio, donde seleccionamos nuestro rol (en este caso student).

3. Seleccionamos el rol estudiante:

    ![captura](https://raw.githubusercontent.com/mmnuria/imagesRested/main/student2.png)

    Nombre de usuario: 12345678W, contraseña: 123456

    Obtenemos nuestro nombre de usuario, con las asignaturas matriculadas, además de que nos ofrece la opción de show report, donde obtendremos nuestro certificado imprimible.

4. Accedemos al Show report:

    ![captura](https://raw.githubusercontent.com/mmnuria/imagesRested/main/student2_report.png)

    Se muestra el contenido del certificado del usuario con una descripción y una tabla de contenido específico.

5. Si se selecciona el botón de Logout, nos devuelve a la página principal (falta implementación ya que era opcional).

## Detalles de la implementación extra del rol profesor:

1. Accedemos como rol profesor y aparecemos en la misma página de welcome, seleccionamos que nuestro rol es teacher y nos redirige a la página siguiente:

    ![captura](https://raw.githubusercontent.com/mmnuria/imagesRested/main/teacher2.png)

    En esta páginas nos muestr anuestro nombre de usuario y las asignaturas que impartimos.

## Descripción del estado actual del grupo:

Hay problemas entre varios compañeros, Joan Escutia y Thomas Azevedo no colaboran en nada, ni responden a whatssap ni siquiera. Hacen actos de presencia en algunas llamadas diciendo que se harán cargo de ciertas cosas y después NO es así. No dan la cara.

Por otro lado, Sonia Palomo, hace algo más pero no es responsable con lo que debe de realizar, además de que hay que estar muy detrás para que contribuya. Realmente hace acto de presencia pero no mucho más.

En general, con respecto a la nota, hay varios compañeros que con un aprobado o una nota media le basta, a diferencia de otros que sí quieren aspirar a la mejor nota. Es por ello que, hay algunos que se esfuerzan mucho más que otros (se puede observar con su contribución en el trabajo).
